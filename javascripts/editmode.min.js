!function(c){function d(e,a){for(var t,i=0,o=e.length;i<o;i++){if(e[i].width<a)return t||e[i];t=e[i]}return e[e.length-1]}function l(){.5<=headerBgCombinedLightness?c(".js-background-type").addClass("light-background").removeClass("dark-background"):c(".js-background-type").addClass("dark-background").removeClass("light-background")}function g(e,a){return a=t(e,a),Math.round((.2126*+a[0]+.7152*+a[1]+.0722*+a[2])/2.55)/100}function m(e,a){e.find(".image_settings").show(),e.removeClass("without-image is-loaded with-error").addClass("with-image not-loaded"),a.removeClass("is-hidden").addClass("is-visible")}function p(e,a){(e=e.closest(".js-content-item-box")).find(".top-inner").append('<div class="edy-img-drop-area-placeholder">'+a+"</div>"),e.find(".top-inner").attr("style",""),e.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),e.find(".edy-img-drop-area").removeClass("active"),e.find(".image_settings").hide(),e.find(".image_settings-remove--input").val(""),e.find(".image_settings-remove--input").trigger("change"),e.find(".form_field-cms").removeClass("with-input")}var t=function(e,a){return function(t,i){if(t&&i){"string"==typeof t&&(t=t.replace(/rgba?\(/,"").replace(/\)/,"").split(","),c.each(t,function(e,a){t[e]=+a})),"string"==typeof i&&(i=i.replace(/rgba?\(/,"").replace(/\)/,"").split(","),c.each(i,function(e,a){i[e]=+a})),"object"==typeof t&&t.hasOwnProperty("length")&&3==t.length&&t.push(1),"object"==typeof i&&i.hasOwnProperty("length")&&3==i.length&&i.push(1);var e=[0,0,0,0];return e[3]=1-(1-i[3])*(1-t[3]),0===e[3]&&(e[3]=1e-6),e[0]=Math.min(i[0]*i[3]/e[3]+t[0]*t[3]*(1-i[3])/e[3],255),e[1]=Math.min(i[1]*i[3]/e[3]+t[1]*t[3]*(1-i[3])/e[3],255),e[2]=Math.min(i[2]*i[3]/e[3]+t[2]*t[3]*(1-i[3])/e[3],255),c.map(e,function(e){return Math.floor(e)})}}(e||[255,255,255,1],a||[255,255,255,1])};handleProductImage=function(e,a,i,o){var s=c(".js-buy-btn-content  .partial .edy-buy-button-container").data("product-id"),n=c(".js-product-page-image .image-drop-area");c.ajax({type:"GET",contentType:"application/json",url:"/admin/api/pages/"+a,dataType:"json"}).then(function(a){function t(){o.closest(".content-item-box").find(".edy-img-drop-area-placeholder").length<1&&p(o,e)}i?a.data.item_image?(n.css("background-image","url("+a.data.item_image.url+")"),c(".js-remove-image").css("display","flex")):i.detail.product.image?(c(".image_settings").css("display","flex"),c(".js-remove-image").css("display","none"),c(".edy-img-drop-area-placeholder").remove(),m(n.closest(".js-content-item-box"),n.find(".js-toggle-crop-state")),n.css("background-image","url("+i.detail.product.image.url+")")):r(a.image)?c(".edy-img-drop-area-placeholder").length<1&&p(n,e):(n.css("background-image","url("+a.image.public_url+")"),c(".js-remove-image").css("display","flex")):s?c.ajax({type:"GET",contentType:"application/json",url:"/admin/api/ecommerce/v1/products/"+s+"?include=details",dataType:"json"}).then(function(e){e.image?(c(".image_settings").css("display","flex"),c(".js-remove-image").css("display","none"),c(".edy-img-drop-area-placeholder").remove(),m(n.closest(".js-content-item-box"),n.find(".js-toggle-crop-state")),n.css("background-image","url("+e.image.url+")")):r(a.image)?t():(n.css("background-image","url("+a.image.public_url+")"),c(".js-remove-image").css("display","flex"))}):t()})};var e,a,r=function(e){for(var a in e)if(e.hasOwnProperty(a))return!1;return JSON.stringify(e)===JSON.stringify({})};e=c(".js-toggle-image-settings"),a=void 0,e.focus(function(){c(window).keyup(function(e){9==(e.keyCode||e.which)&&a()})});var i=function(){c(".js-image-settings-popover").toggleClass("active")};c(".js-toggle-image-settings").click(function(){i()});window.site=c.extend(window.site||{},{toggleFlags:function(){c(".js-option-toggle-flags").on("click",function(e){e.stopPropagation(),e=!c(this).hasClass("js-flag-disable-btn"),c(this).toggleClass("js-flag-disable-btn"),c("body").toggleClass("flags-enabled flags-disabled"),siteData.set("flags_state",e)})},getImageByWidth:d,headerBgPreview:function(e,a){var t=c(".js-header-banner").css("background-image"),i=e.imageSizes?d(e.imageSizes,c(window).width()):null,o=e.image&&""!==e.image?"url("+i.url+")":"none",i=e.imageSizes&&""!==e.imageSizes?e.imageSizes:null,s=e.color&&""!==e.color?e.color:"rgba(0,0,0,0)",n=(e.colorData&&""!==e.colorData&&e.colorData.lightness,c("<img>")),r=c("<canvas>"),e=e.image&&""!==e.image?e.image:null;e?!function(e,a){for(var t=e.length;t--;)if(-1<a.indexOf(e[t].url.trim()))return!0;return!1}(i,t)?(n.attr("src",e.replace(/.*\/(photos|voogstock)/g,"/photos")),n.on("load",function(){ColorExtract.extract(n[0],r[0],function(e){headerBg.headerBgImageColor=e.bgColor||"rgba(255,255,255,1)",headerBgCombinedLightness=g(headerBg.headerBgImageColor,s),l()})})):(headerBg.headerBgImageColor=headerBg.headerBgImageColor||"rgba(178,198,207,1)",headerBgCombinedLightness=g(headerBg.headerBgImageColor,s),l()):(headerBg.headerBgImageColor="rgba(255,255,255,1)",headerBgCombinedLightness=g(headerBg.headerBgImageColor,s),l()),c(a).css({"background-image":o}),c(a).find(".background-color").css({"background-color":s})},headerBgCommit:function(e,a){var t,i=c.extend(!0,{},e);i.image=e.image||"",i.imageSizes=null==(t=e.imageSizes)||"string"==typeof t&&t.match(/^[\\'"]+$/)?"":t,i.color=e.color||"rgba(255,255,255,0)",i.combinedLightness=headerBgCombinedLightness,pageData.set(a,i)},handleHeaderColorScheme:function(e){void 0!==e&&(.6<e?c(".header-wrapper").addClass("light").removeClass("dark"):c(".header-wrapper").addClass("dark").removeClass("light"))},bindCustomTexteditorStyles:function(e){window.edy=window.edy||[],edy.push(["texteditorStyles",{name:e,tagname:"a",attribute:{href:"#"},classname:"custom-btn",toggle:!0}])},bindContentItemImgDropAreas:function(n,r,d){c(".js-content-item-img-drop-area").each(function(e,a){var i=c(a),s=i.closest(".js-content-item-box"),t=s.find(".image_settings-remove"),o=s.data("item-id"),a=s.data("item-type");s.data("image-type"),new Edicy.CustomData({type:a,id:o}),new Edicy.ImgDropArea(i,{positionable:!1,target_width:2048,placeholder:'<div class="edy-img-drop-area-placeholder">'+n+"</div>",removeBtn:null,change:function(e){var a=s.find(".js-toggle-crop-state");i.removeClass("is-cropped").addClass("not-cropped").css("opacity",.1),e?(m(s,a),c(".js-remove-image").css("display","flex")):(s.find(".image_settings").hide(),s.removeClass("with-image is-loaded with-error").addClass("without-image not-loaded"),a.addClass("is-hidden").removeClass("is-visible"),s.find(".edy-img-drop-area-placeholder").css("opacity",0));var t=s.data("item-type"),a=s.data("item-id");new Edicy.CustomData({type:t,id:a}).set({[d]:"not-cropped",[r]:e}),s.removeClass("not-loaded with-error").addClass("is-loaded"),s.find(".edy-img-drop-area-placeholder").css("opacity",1),i.css("opacity",1)}});t.on("click",function(){var a=c(this),t=s.data("item-id"),i=s.data("item-type"),o=new Edicy.CustomData({type:i,id:t});o.get({success:function(e){e.item_image?o.remove(r,{success:function(e){o.remove(d,{success:function(e){"article"!==i?handleProductImage(n,t,null,a):p(a,n)}})}}):c.ajax({type:"PUT",contentType:"application/json",url:"/admin/api/pages/"+t,dataType:"json",data:JSON.stringify({image_id:null})}).then(function(e){p(a,n)})}})})})},bindContentItemImageCropToggle:function(i){c(".js-toggle-crop-state").on("click",function(){var e=c(this).closest(".js-content-item-box"),a=e.find(".js-content-item-img-drop-area"),t=e.data("item-id"),e=e.data("item-type"),t=new Edicy.CustomData({type:e,id:t}),a=a.hasClass("is-cropped")?(a.removeClass("is-cropped").addClass("not-cropped"),"not-cropped"):(a.removeClass("not-cropped").addClass("is-cropped"),"is-cropped");t.set(i,a)})},bindProductListeners:function(a,t){document.addEventListener("voog:ecommerce:buttonproductsave",function(e){handleProductImage(a,t,e)})}}),c(".js-data-item").each(function(){c(this).on("change",function(e){var a;a="checkbox"===e.target.type?e.target.checked:e.target.value;var t=e.target.dataset.name,i=e.target.dataset.id,o=e.target.dataset.entity,s=e.target.dataset.reload;("site"==o?new Edicy.CustomData({type:"site"}):new Edicy.CustomData({type:o,id:i})).set({[t]:a},{success:function(){s&&location.reload()}})})}),c(".form_field-cms input").length&&(1<=c(".form_field-cms input").val().length?c(".form_field-cms input").closest(".form_field-cms").addClass("with-input"):c(".form_field-cms input").closest(".form_field-cms").removeClass("with-input")),c(document).ready(function(){c(".form_field-cms input").keyup(function(e){1<=c(this).val().length?c(this).closest(".form_field-cms").addClass("with-input"):c(this).closest(".form_field-cms").removeClass("with-input")})})}(jQuery);